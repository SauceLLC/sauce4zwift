<!DOCTYPE html>
<html class="" tabindex="0" autofocus>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';"/>

        <title>Index - Sauce for Zwift™</title>

        <script src="./src/preloads.js"></script>

        <link id="favicon" rel="shortcut icon" href="/pages/images/favicon.png"/>
        <link rel="stylesheet" href="/pages/css/common.css"/>

        <script type="module">
            import {sanitizeAttr, stripHTML} from './src/common.mjs';
            const icons = {
                watching: 'grid_view',
                groups: 'scatter_plot',
                nearby: 'table',
                geo: 'map',
                chat: 'chat',
                segments: 'conversion_path',
                "game-control": 'stadia_controller',
                analysis: 'monitoring',
                events: 'event',
                athletes: 'person_search',
                "power-gauge": 'speed',
                "draft-gauge": 'speed',
                "pace-gauge": 'speed',
                "hr-gauge": 'speed',
                "cadence-gauge": 'speed',
                "wbal-gauge": 'speed',
                "stats-for-nerds": 'receipt_long',
                "logs": 'notes',
            };
            async function main() {
                const {value: windows} = await (await fetch('/api/rpc/v1/getWebWindowManifests')).json();
                const windowsByGroup = new Map();
                for (const x of windows) {
                    const group = x.groupTitle || 'Main';
                    if (!windowsByGroup.has(group)) {
                        windowsByGroup.set(group, []);
                    }
                    windowsByGroup.get(group).push(x);
                }
                for (const [group, windows] of windowsByGroup.entries()) {
                    const links = [];
                    for (const x of windows) {
                        links.push(`<a href="${x.file}"
                                       title="${sanitizeAttr(stripHTML(x.prettyDesc))}">
                                      <ms>${icons[x.type] || 'construction'}</ms> ${stripHTML(x.prettyName)}</a>`);
                    }
                    document.body.insertAdjacentHTML('beforeend',
                        `<h4>${stripHTML(group)}</h4>
                         <div class="windows">${links.join('\n')}</div>`);
                }
            }
            main();
        </script>

        <style>
            html {
                font-size: 4.8mm;
            }

            .mods:not('.active') {
                display: none;
            }

            html > body {
                padding: 1em;
                overflow: auto;
                overflow: overlay;
            }

            .title {
                text-shadow:
                    0 0 1px black,
                    0 0 1px black,
                    1px 1px 4px #0008;
                margin-bottom: 0.5em;
            }

            .windows {
                display: flex;
                align-items: flex-start;
                flex-direction: column;
                font-size: 0.9em;
            }

            .windows a > ms {
                font-size: 1.8em;
                font-weight: 300;
                margin: 0 0.2em 0 0;
            }

            .primary {
            }

            a {
                margin-bottom: 0.1em;
                padding: 0.22em 0.6em;
                display: flex;
                align-items: center;
                text-decoration: none !important;
            }

            a:hover {
                background-color: #2223;
                border-radius: 0.28em;
            }

            img.logo {
                --tilt: -28deg;
                display: inline-block;
                margin: -0.8em 0.2em;
                width: 2.5em;
                animation: pournshake 6s infinite;
            }

            html:not(:focus-within) img.logo {
                animation-play-state: paused;
            }
        </style>
    </head>
    <body>
        <h2 class="title">
            Sauce for Zwift™
            <img class="logo" src="images/icon256.png"/>
        </h2>
        <a href="/pages/overview-settings.html"><ms>settings</ms> Settings</a>
    </body>
</html>
